@model chas_happenings.Models.CalendarMonthViewModel

@{
    ViewData["Title"] = "Home - Chas Happenings";
}


<div id="layout">
    <div id="side1">
    </div>

    <div id="middle-container">
        <!-- CALENDAR (top-left, ~80% width) -->
        <section id="calendar">
            <h2>@Model.MonthTitle</h2>

            <div class="calendar-grid">
                <!-- Weekday header row: MONDAY to SUNDAY -->
                <div class="calendar-cell header">Mon</div>
                <div class="calendar-cell header">Tue</div>
                <div class="calendar-cell header">Wed</div>
                <div class="calendar-cell header">Thu</div>
                <div class="calendar-cell header">Fri</div>
                <div class="calendar-cell header">Sat</div>
                <div class="calendar-cell header">Sun</div>

                @{
                    // First day of the shown month
                    var firstDay = new DateTime(Model.Year, Model.Month, 1);

                    // .NET DayOfWeek: Sunday=0, Monday=1, ...
                    // Convert so that Monday = 0, Sunday = 6
                    int offset = ((int)firstDay.DayOfWeek + 6) % 7;
                }

                @* Empty cells BEFORE the 1st so the month starts on the right weekday *@
                @for (int i = 0; i < offset; i++)
                {
                    <div class="calendar-cell empty"></div>
                }

                @* One cell per day, with zero or many event "boxes" *@
                @foreach (var day in Model.Days)
                {
                    <div class="calendar-cell day-cell">
                        <div class="day-number">@day.Date.Day</div>

                        <div class="day-events">
                            @foreach (var ev in day.Events)
                            {
                                // Map the event type text to a clean CSS class
                                var typeClass = ev.TypeName switch
                                {
                                    "School" => "school",
                                    "StudentBody" => "studentbody",
                                    "StudentBodey" => "studentbody",   // typo-safe
                                    "Leasson" => "leasson",
                                    "StudentEvent" => "studentevent",
                                    _ => ""               // default: no extra class
                                };

                                <div class="event-pill @typeClass"
                                     onclick="onCalendarEventClick(@ev.EventId)">
                                    <div>@ev.TimeRange</div>
                                    <div>@ev.Title</div>
                                    <div>@ev.TypeName</div>
                                </div>
                            }
                        </div>
                    </div>
                }
            </div>
        </section>

        <!-- DYNAMIC INFO (top-right, ~20% width) -->
        <section id="dynamic-info">
            <!-- empty for now -->
        </section>

        <!-- ARTICLE (bottom row, spans full width, grows with scroll) -->
        <section id="article">
            <h2>Article</h2>
            <p>
                This is placeholder article content. Add more text here and this
                section will keep expanding downward. The user scrolls to see more.
            </p>
            <p>
                Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer
                volutpat, lorem at tincidunt lacinia, justo arcu porta lorem,
                hendrerit semper dui felis sed velit.
            </p>
        </section>
    </div>

    <div id="side2">
    </div>
</div>
